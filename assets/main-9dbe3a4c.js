!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const n of e)if("childList"===n.type)for(const e of n.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();const e=e=>{const t=document.getElementById(e);if(!t)throw new Error(`Element with id "${e}" not found`);return t},t=(e,t,n)=>{const i=document.createElement(e);return t&&(i.className=t),n&&(i.textContent=n),i};let n;const i={success:"‚úì",error:"‚úï",warning:"‚ö†",info:"i"},l=(e,t,l="info",o=5e3)=>{const r=((e,t,n)=>{const i=document.createElement(e);return i.className=t,i.innerHTML=n,i})("div",`toast ${l}`,`\n    <div class="toast-icon">${i[l]||"i"}</div>\n    <div class="toast-content">\n        <div class="toast-title">${e}</div>\n        <div class="toast-message">${t}</div>\n    </div>\n    <button class="toast-close" aria-label="Close notification">√ó</button>\n    <div class="toast-progress" style="width: 100%;"></div>\n    `),a=r.querySelector(".toast-close"),c=r.querySelector(".toast-progress");a.addEventListener("click",()=>s(r)),n.appendChild(r),requestAnimationFrame(()=>{r.classList.add("show")}),o>0&&(c.style.transition=`width ${o}ms linear`,c.style.width="0%",setTimeout(()=>{s(r)},o));const d=n.querySelectorAll(".toast");d.length>5&&s(d[0])},s=e=>{e.classList.remove("show"),setTimeout(()=>{e.parentNode&&e.parentNode.removeChild(e)},300)};const o={allFiles:[],filteredFiles:[],allFolders:[],folderCache:new Map,currentFolderFilter:null,currentPage:1,itemsPerPage:50,totalPages:0},r=new class{constructor(){this.API_BASE=this.getApiBase()}getApiBase(){return"localhost"===window.location.hostname||window.location.hostname,"/api/drive"}async loadAllFilesAndFolders(e=!1){try{console.log("üì° Fetching data from service account API...");const t=`${this.API_BASE}?type=both${e?"&refresh=true":""}`,n=await fetch(t,{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json"}}).catch(e=>{throw console.error("‚ùå Fetch error:",e),e});if(!n.ok){const e=await n.text().catch(()=>"Unknown error");if(console.error("‚ùå API Response:",n.status,n.statusText),console.error("‚ùå Error details:",e),404===n.status)throw new Error("Service account API not available. Make sure the backend is deployed or running locally.");throw new Error(`API request failed: ${n.status} ${n.statusText}\n${e}`)}const i=await n.json();return console.log(`üìä Loaded ${i.files?.length||0} files, ${i.folders?.length||0} folders ${i.cached?"(cached)":"(fresh from Google Drive)"}`),{files:i.files||[],folders:i.folders||[],cached:i.cached||!1}}catch(t){console.error("‚ùå Service account API error:",t);const e=t instanceof Error?t.message:"Unknown error";if(e.includes("Failed to fetch")||e.includes("NetworkError"))throw new Error("Unable to connect to service account API. The backend API is not running.");throw new Error(`Failed to load Drive content: ${e}`)}}async loadAllFiles(){try{console.log("üîç Loading files via service account...");const e=await fetch(`${this.API_BASE}?type=files`);if(!e.ok)throw new Error(`API request failed: ${e.status}`);const t=await e.json();return console.log(`üìÑ Service account loaded: ${t.files.length} files`),t.files||[]}catch(e){throw console.error("‚ùå Service account files error:",e),e}}async loadAllFolders(){try{console.log("üìÇ Loading folders via service account...");const e=await fetch(`${this.API_BASE}?type=folders`);if(!e.ok)throw new Error(`API request failed: ${e.status}`);const t=await e.json();return console.log(`üìÅ Service account loaded: ${t.folders.length} folders`),t.folders||[]}catch(e){throw console.error("‚ùå Service account folders error:",e),e}}getFilesInFolder(e,t,n){const i=t.filter(t=>t.parents&&t.parents.includes(e)),l=this.getSubfolderIds(e,n);return[...i,...t.filter(e=>e.parents&&e.parents.some(e=>l.includes(e)))].filter((e,t,n)=>n.findIndex(t=>t.id===e.id)===t)}getSubfolderIds(e,t){const n=[];return t.filter(t=>t.parents&&t.parents.includes(e)).forEach(e=>{n.push(e.id);const i=this.getSubfolderIds(e.id,t);n.push(...i)}),n}},a=new class{getFileIcon(e){return`<div class="file-type-icon ${this.getFileIconClass(e)}"></div>`}getFileIconClass(e){return e.includes("pdf")?"icon-pdf":e.includes("document")?"icon-document":e.includes("spreadsheet")?"icon-spreadsheet":e.includes("presentation")?"icon-presentation":e.includes("video")?"icon-video":e.includes("image")?"icon-image":e.includes("folder")?"icon-folder":e.includes("text")?"icon-text":"icon-file"}detectContentType(e){const t=e.toLowerCase();return t.includes("drill")||t.includes("harjoitus")||t.includes("exercise")?"drill":t.includes("tactic")||t.includes("taktiikka")||t.includes("strategy")?"tactic":t.includes("plan")||t.includes("ohjelma")||t.includes("session")||t.includes("practice")?"plan":t.includes("video")||t.includes("demo")||t.includes("example")?"video":"general"}isRecentlyAccessed(e){return JSON.parse(localStorage.getItem("recentFiles")||"[]").includes(e.id)}getContentTypeLabel(e){return{drill:"Harjoitus",tactic:"Taktiikka",plan:"Suunnitelma",video:"Video",general:"Materiaali"}[e]||"Materiaali"}createActionButtons(e){return`\n      <div class="file-actions">\n        <button class="action-btn" onclick="window.open('${e.webViewLink}', '_blank')" title="Avaa Google Drivessa">\n          Avaa\n        </button>\n        <button class="action-btn secondary" onclick="FileActions.addToSession('${e.id}')" title="Lis√§√§ harjoitukseen">\n          + Harjoitus\n        </button>\n        <button class="action-btn secondary" onclick="FileActions.downloadFile('${e.webViewLink}')" title="Lataa">\n          ‚¨á\n        </button>\n      </div>\n    `}createFileItem(e){const n=t("div","file-item"),i=this.detectContentType(e.name),l=this.isRecentlyAccessed(e),s=this.getFileIcon(e.mimeType),o=new Date(e.modifiedTime).toLocaleDateString("fi-FI"),r=this.createActionButtons(e);return n.setAttribute("data-type",i),l&&n.classList.add("recently-accessed"),n.innerHTML=`\n      <div class="file-icon">${s}</div>\n      <div class="file-info">\n        <a href="${e.webViewLink}" target="_blank" rel="noopener noreferrer" class="file-name">\n          ${e.name}\n        </a>\n        <div class="file-meta">\n          <span class="file-date">Muokattu: ${o}</span>\n          <span class="content-type-badge">${this.getContentTypeLabel(i)}</span>\n        </div>\n      </div>\n      ${r}\n    `,n}createSkeletonItem(){const e=t("div","file-item skeleton-item");return e.innerHTML='\n      <div class="file-icon skeleton-circle"></div>\n      <div class="file-info">\n        <div class="skeleton-text skeleton-title"></div>\n        <div class="skeleton-text skeleton-date"></div>\n      </div>\n    ',e}createCategorySkeleton(){const e=t("div","category skeleton-category");return e.innerHTML='\n      <div class="skeleton-text skeleton-category-title"></div>\n      <div class="skeleton-text skeleton-category-item"></div>\n      <div class="skeleton-text skeleton-category-item"></div>\n      <div class="skeleton-text skeleton-category-item"></div>\n    ',e}createEmptyState(e,n){const i=t("div","empty-state");return i.innerHTML=e?'\n        <div class="empty-icon">üîç</div>\n        <h3>No training resources found</h3>\n        <p>Try adjusting your search terms or browse by category instead.</p>\n        <button class="empty-action" onclick="searchInput.value=\'\'; handleSearch();">\n          Clear Search\n        </button>\n      ':n?'\n        <div class="empty-icon">üìã</div>\n        <h3>No files in this category</h3>\n        <p>This category is currently empty. Files will appear here when they match the category criteria.</p>\n      ':'\n        <div class="empty-icon">üìÅ</div>\n        <h3>Welcome to Hawks Coach Hub</h3>\n        <p>Sign in with Google Drive to access your training resources, drills, and tactical materials.</p>\n        <div class="empty-steps">\n          <div class="step">\n            <span class="step-number">1</span>\n            <span>Click "Sign In" above</span>\n          </div>\n          <div class="step">\n            <span class="step-number">2</span>\n            <span>Authorize Google Drive access</span>\n          </div>\n          <div class="step">\n            <span class="step-number">3</span>\n            <span>Start browsing your files</span>\n          </div>\n        </div>\n      ',i}groupFilesByCategory(e){const t={"Floorball Drills":[],"Tactics & Strategy":[],"Training Plans":[],"Video Resources":[],"Diagrams & Images":[],Documents:[],Other:[]};return e.forEach(e=>{const n=e.name.toLowerCase(),i=e.mimeType;n.includes("drill")||n.includes("exercise")||n.includes("training")||n.includes("floorball")?t["Floorball Drills"].push(e):n.includes("tactic")||n.includes("strategy")||n.includes("formation")?t["Tactics & Strategy"].push(e):n.includes("plan")||n.includes("program")||n.includes("schedule")||n.includes("season")?t["Training Plans"].push(e):i.includes("video")||n.includes(".mp4")||n.includes(".mov")?t["Video Resources"].push(e):i.includes("image")||n.includes(".jpg")||n.includes(".png")?t["Diagrams & Images"].push(e):i.includes("document")||i.includes("pdf")||i.includes("text")?t.Documents.push(e):t.Other.push(e)}),t}createCategorySection(e,n){const i=t("div","category"),l=t("h3");l.textContent=`${e} (${n.length})`,i.appendChild(l);const s=t("div","file-list");return n.forEach(e=>{const t=this.createFileItem(e);s.appendChild(t)}),i.appendChild(s),i}},c=new class{filterFilesBySearch(e,t){if(!t.trim())return e;const n=t.toLowerCase().trim();return e.filter(e=>e.name.toLowerCase().includes(n))}filterFilesByFolder(e,t,n){if(!t)return e;const i=n.get(t);return i&&i.files||[]}filterFiles(e,t,n,i){let l=e;return n&&(l=this.filterFilesByFolder(e,n,i)),this.filterFilesBySearch(l,t)}debounce(e,t){let n;return(...i)=>{clearTimeout(n),n=setTimeout(()=>e.apply(null,i),t)}}},d={isActive:!1,selectedFiles:new Set,sessionName:""};window.FileActions={addToSession:e=>{d.isActive?(d.selectedFiles.add(e),C(),l("Tiedosto lis√§tty","Materiaali lis√§tty harjoitussuunnitelmaan","success",2e3)):(d.isActive=!0,d.selectedFiles.add(e),b(),C(),l("Harjoitussuunnittelu aloitettu","Ensimm√§inen materiaali lis√§tty","info",3e3))},downloadFile:e=>{window.open(e,"_blank")},togglePlanningMode:()=>{d.isActive=!d.isActive,d.isActive||d.selectedFiles.clear(),b(),C()},exportSession:()=>{if(0===d.selectedFiles.size)return void l("Ei materiaaleja","Lis√§√§ ensin materiaaleja harjoitukseen","warning",3e3);const e=Array.from(d.selectedFiles).map(e=>o.allFiles.find(t=>t.id===e)).filter(Boolean).map(e=>`‚Ä¢ ${e.name}\n  üîó ${e.webViewLink}`).join("\n\n"),t=`HAWKS HARJOITUSSUUNNITELMA\nLuotu: ${(new Date).toLocaleDateString("fi-FI")}\n\nMATERIAALIT (${d.selectedFiles.size} kpl):\n${e}\n\n----\nLuotu Hawks Valmennuskeskuksessa\nüìÅ Kaikki materiaalit: https://drive.google.com/drive/folders/1ZF6AHx62MXfkgs7-xbrMxj4r9sdyKzUb`;navigator.clipboard.writeText(t).then(()=>{l("Suunnitelma kopioitu","Harjoitussuunnitelma kopioitu leikep√∂yd√§lle","success",3e3)}).catch(()=>{l("Virhe","Harjoitussuunnitelma kopioitu leikep√∂yd√§lle","error",3e3)})},removeFromSession:e=>{d.selectedFiles.delete(e),C(),l("Materiaali poistettu","Materiaali poistettu harjoitussuunnitelmasta","info",2e3)}};const u=e("searchInput"),g=e("refreshButton"),f=e("allFilesList");function h(e,t="info"){console.log(`Status: ${e} (${t})`);const n=document.getElementById("loadingStatus"),i=n?.querySelector(".loading-text");n&&i?"loading"===t?(i.textContent=e,n.style.display="flex",console.log("‚úÖ Loading indicator SHOWN:",e)):(n.style.display="none",console.log("‚úÖ Loading indicator HIDDEN")):console.log("‚ùå Loading status element not found")}function m(){document.querySelectorAll(".skeleton-loading").forEach(e=>e.remove())}const p=async(e=!1)=>{h("Yhdistet√§√§n Google Drive APIin...","loading"),f.innerHTML='\n    <div class="skeleton-loading">\n      <div class="skeleton-item"></div>\n      <div class="skeleton-item"></div>\n      <div class="skeleton-item"></div>\n    </div>\n  ';try{const t=performance.now();h("Ladataan harjoitusmateriaaleja...","loading");const n=setInterval(()=>{const e=Math.round((performance.now()-t)/1e3);e>5&&h(`Ladataan... ${e}s (haetaan ${o.allFiles.length||104} tiedostoa)`,"loading")},2e3),i=await r.loadAllFilesAndFolders(e);clearInterval(n);const s=performance.now()-t;console.log(`‚ö° Loaded ${i.files.length} files, ${i.folders.length} folders in ${Math.round(s)}ms ${i.cached?"(cached)":"(from Google Drive)"}`),o.allFiles=i.files,o.allFolders=i.folders,o.filteredFiles=[...i.files],function(){console.log("üóÇÔ∏è Caching folder structure:",o.allFolders.length,"folders,",o.allFiles.length,"files"),o.folderCache.clear();let e=0;o.allFolders.forEach(t=>{const n=o.allFiles.filter(e=>e.parents&&e.parents.includes(t.id)),i=y(t.id,o.allFolders),l={...t,fileCount:n.length,hierarchyLevel:i};o.folderCache.set(t.id,l),n.length>0&&e++}),console.log(`‚úÖ Cached ${o.allFolders.length} folders, ${e} have files`)}(),m(),h("","info"),v(),F(),$(),C(),setTimeout(()=>{console.log("üîß Direct DOM update fallback - checking elements");const e=document.getElementById("totalFiles"),t=document.getElementById("totalFolders"),n=document.getElementById("currentViewCount");console.log("üîç DOM elements found:",{totalFiles:!!e,totalFolders:!!t,currentView:!!n}),e&&(e.textContent=o.allFiles.length.toString(),console.log(`‚úÖ Set totalFiles to: ${o.allFiles.length}`)),t&&(t.textContent=o.allFolders.length.toString(),console.log(`‚úÖ Set totalFolders to: ${o.allFolders.length}`)),n&&(n.textContent=o.filteredFiles.length.toString(),console.log(`‚úÖ Set currentView to: ${o.filteredFiles.length}`)),$(),console.log(`üîß Direct update completed: ${o.allFiles.length} files, ${o.allFolders.length} folders`)},1e3),0===i.files.length&&0===i.folders.length?(h("No training materials found","info"),l("No Content Found","No training resources found in the Hawks folder","info")):(h(`Successfully loaded ${i.files.length} files and ${i.folders.length} folders`,"success"),l("Hawks Training Materials Loaded",`Found ${i.files.length} files and ${i.folders.length} folders`,"success"))}catch(t){console.error("Error loading files:",t),m();h(`Error loading files: ${t instanceof Error?t.message:"Unknown error"}`,"error"),l("Loading Error","Failed to load training materials. Please try refreshing the page.","error")}};function y(e,t){const n="1ZF6AHx62MXfkgs7-xbrMxj4r9sdyKzUb";if(e===n)return-1;const i=t.find(t=>t.id===e);if(!i||!i.parents||0===i.parents.length)return 999;const l=i.parents[0];return l?l===n?0:y(l,t)+1:999}function v(){if(f.innerHTML="",0===o.filteredFiles.length){const e=""!==u.value.trim(),t=a.createEmptyState(e,o.allFiles.length>0);return f.appendChild(t),void A()}const e=(o.currentPage-1)*o.itemsPerPage,t=e+o.itemsPerPage;o.filteredFiles.slice(e,t).forEach(e=>{const t=a.createFileItem(e);f.appendChild(t)}),A()}function F(){const e=document.getElementById("folderChipsBar"),t=document.getElementById("folderChips");if(!e||!t)return;if(0===o.allFolders.length)return void(e.style.display="none");e.style.display="block",t.innerHTML="";const n=document.createElement("button");n.className="folder-chip "+(null===o.currentFolderFilter?"active":""),n.setAttribute("data-folder-id",""),n.innerHTML=`\n    <span class="folder-chip-icon">üìÅ</span>\n    <span>Kaikki tiedostot</span>\n    <span class="folder-chip-count">${o.allFiles.length}</span>\n  `,n.onclick=()=>k(null),t.appendChild(n);const i=Array.from(o.folderCache.values()).filter(e=>e.fileCount&&e.fileCount>0),l=["harjoitus","practice","drill","exercise","treeni","suunnittelu","planning","plan","opetus","teaching","taito","skill","tekniikka","technique","taktii","tactic"],s=i.sort((e,t)=>{const n=e.hierarchyLevel||999,i=t.hierarchyLevel||999;if(n!==i)return n-i;const s=l.some(t=>e.name.toLowerCase().includes(t.toLowerCase())),o=l.some(e=>t.name.toLowerCase().includes(e.toLowerCase()));return s&&!o?-1:!s&&o?1:(t.fileCount||0)-(e.fileCount||0)}).slice(0,8);console.log(`üèí Displaying ${s.length} folder chips`),s.forEach(e=>{const n=document.createElement("button");n.className="folder-chip "+(o.currentFolderFilter===e.id?"active":""),n.setAttribute("data-folder-id",e.id),n.innerHTML=`\n      <span class="folder-chip-icon">üìÇ</span>\n      <span>${e.name}</span>\n      <span class="folder-chip-count">${e.fileCount}</span>\n    `,n.onclick=()=>k(e.id),t.appendChild(n)})}function k(e){if(o.currentFolderFilter=e,o.currentPage=1,e){console.log(`üîç Filtering by folder ${e}`),console.log(`üìä Available: ${o.allFiles.length} files, ${o.allFolders.length} folders`);const t=r.getFilesInFolder(e,o.allFiles,o.allFolders);o.filteredFiles=t,console.log(`üìÑ Found ${t.length} files in folder`),t.length>0&&console.log("üìù Sample files:",t.slice(0,3).map(e=>e.name));const n=o.folderCache.get(e),i=n?.name||"Unknown Folder";console.log(`üìÅ Folder name: ${i}`),h(`N√§ytet√§√§n kansio: ${i} ja alikansiot (${t.length} tiedostoa)`,"info")}else o.filteredFiles=[...o.allFiles],h(`N√§ytet√§√§n kaikki tiedostot (${o.allFiles.length} tiedostoa)`,"info");v(),F(),$(),C()}function w(){const e=u.value.trim().toLowerCase();if(!e)return void k(o.currentFolderFilter);const t=o.currentFolderFilter?r.getFilesInFolder(o.currentFolderFilter,o.allFiles,o.allFolders):o.allFiles;o.filteredFiles=c.filterFilesBySearch(t,e),o.currentPage=1,h(`Hakutulokset: ${o.filteredFiles.length} tiedostoa l√∂ytyi`,"info"),v(),$(),C()}function $(){const e=document.getElementById("totalFiles"),t=document.getElementById("totalFolders"),n=document.getElementById("currentViewCount"),i=document.getElementById("fileCount");if(e&&(e.textContent=o.allFiles.length.toString()),t&&(t.textContent=o.allFolders.length.toString()),n&&(n.textContent=o.filteredFiles.length.toString()),i){const e=1===o.filteredFiles.length?"1 tiedosto l√∂ytyi":`${o.filteredFiles.length} tiedostoa l√∂ytyi`;i.textContent=e}}function A(){o.totalPages=Math.ceil(o.filteredFiles.length/o.itemsPerPage);const e=document.getElementById("paginationInfo"),t=document.getElementById("paginationControls");if(!e||!t)return;if(o.totalPages<=1)return t.style.display="none",void(e.textContent="");t.style.display="flex";const n=(o.currentPage-1)*o.itemsPerPage+1,i=Math.min(o.currentPage*o.itemsPerPage,o.filteredFiles.length);e.textContent=`${n}-${i} / ${o.filteredFiles.length}`;const l=document.getElementById("prevPage"),s=document.getElementById("nextPage");l&&(l.disabled=1===o.currentPage,l.onclick=()=>{o.currentPage>1&&(o.currentPage--,v())}),s&&(s.disabled=o.currentPage===o.totalPages,s.onclick=()=>{o.currentPage<o.totalPages&&(o.currentPage++,v())})}const b=()=>{const e=document.getElementById("session-planning-bar");if(!e)return;e.style.display=d.isActive?"flex":"none";const t=document.querySelector(".planning-toggle-btn");t&&(t.textContent=d.isActive?"Lopeta suunnittelu":"Aloita harjoitussuunnittelu",t.classList.toggle("active",d.isActive)),document.querySelectorAll(".file-item").forEach(e=>{e.classList.toggle("planning-mode",d.isActive)})},C=()=>{const e=document.getElementById("session-count"),n=document.getElementById("session-materials-list");e&&(e.textContent=d.selectedFiles.size.toString()),n&&(n.innerHTML="",0===d.selectedFiles.size?n.innerHTML='<div class="session-empty">Ei materiaaleja valittuna</div>':Array.from(d.selectedFiles).forEach(e=>{const i=o.allFiles.find(t=>t.id===e);if(i){const l=t("div","session-material-item");l.innerHTML=`\n            <span class="material-name">${i.name}</span>\n            <button class="remove-material-btn" onclick="window.FileActions.removeFromSession('${e}')" title="Poista">√ó</button>\n          `,n.appendChild(l)}})),document.querySelectorAll(".file-item").forEach(e=>{const t=e.querySelector(".add-to-session-btn");if(t){const n=t.getAttribute("data-file-id"),i=n&&d.selectedFiles.has(n);e.classList.toggle("in-session",!!i),t&&(t.textContent=i?"‚úì Lis√§tty":"+ Harjoitus",t.classList.toggle("added",!!i))}})};document.addEventListener("DOMContentLoaded",async function(){console.log("üèí Hawks Coach Hub - Service Account Version initializing..."),n=e("toastContainer"),u.addEventListener("input",w),g.addEventListener("click",()=>p(!0)),setInterval(p,9e5),console.log("Event listeners initialized"),document.querySelectorAll("#authorize_div, #signout_div").forEach(e=>{e instanceof HTMLElement&&(e.style.display="none")}),await p(),console.log("‚úÖ Hawks Coach Hub initialized successfully")});
//# sourceMappingURL=main-9dbe3a4c.js.map
