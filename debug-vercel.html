<!DOCTYPE html>
<html lang="fi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vercel Debugging - Hawks Coach Hub</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 2rem; line-height: 1.6; }
        .debug-info { background: #f5f5f5; padding: 1rem; margin: 1rem 0; border-radius: 4px; }
        .error { background: #ffe6e6; border-left: 4px solid #ff0000; }
        .success { background: #e6ffe6; border-left: 4px solid #00aa00; }
        .warning { background: #fff3cd; border-left: 4px solid #ffc107; }
        code { background: #f1f1f1; padding: 2px 4px; border-radius: 2px; }
    </style>
</head>
<body>
    <h1>üîß Hawks Coach Hub - Vercel Debugging</h1>
    
    <div class="debug-info">
        <h3>Environment Information</h3>
        <p><strong>Domain:</strong> <span id="domain"></span></p>
        <p><strong>Protocol:</strong> <span id="protocol"></span></p>
        <p><strong>User Agent:</strong> <span id="userAgent"></span></p>
    </div>

    <div class="debug-info">
        <h3>Credential Loading Test</h3>
        <p><strong>CLIENT_ID:</strong> <span id="clientId">Loading...</span></p>
        <p><strong>API_KEY:</strong> <span id="apiKey">Loading...</span></p>
    </div>

    <div class="debug-info">
        <h3>Google API Loading Test</h3>
        <p><strong>gapi:</strong> <span id="gapiStatus">Loading...</span></p>
        <p><strong>google:</strong> <span id="googleStatus">Loading...</span></p>
        <p><strong>google.accounts:</strong> <span id="accountsStatus">Loading...</span></p>
    </div>

    <div class="debug-info">
        <h3>Recommended Google Cloud Console Settings</h3>
        <p><strong>Authorized JavaScript origins:</strong></p>
        <ul>
            <li><code>https://hawks-coach-hub.vercel.app</code></li>
            <li><code>https://localhost:8000</code> (for development)</li>
        </ul>
        
        <p><strong>API Key Restrictions:</strong></p>
        <ul>
            <li><strong>HTTP referrers:</strong> <code>https://hawks-coach-hub.vercel.app/*</code></li>
            <li><strong>APIs:</strong> Google Drive API v3</li>
        </ul>
    </div>

    <div id="errorLog" class="debug-info error" style="display: none;">
        <h3>Error Log</h3>
        <div id="errors"></div>
    </div>

    <script src="env-loader.js"></script>
    <script src="https://apis.google.com/js/api.js" async defer onload="window.gapiLoaded = true"></script>
    <script src="https://accounts.google.com/gsi/client" async defer onload="window.gisLoaded = true"></script>
    
    <script>
        // Environment info
        document.getElementById('domain').textContent = window.location.hostname;
        document.getElementById('protocol').textContent = window.location.protocol;
        document.getElementById('userAgent').textContent = navigator.userAgent;

        // Error tracking
        const errors = [];
        window.addEventListener('error', (e) => {
            errors.push(`${new Date().toISOString()}: ${e.message} at ${e.filename}:${e.lineno}`);
            updateErrorLog();
        });

        function updateErrorLog() {
            const errorDiv = document.getElementById('errorLog');
            const errorsDiv = document.getElementById('errors');
            if (errors.length > 0) {
                errorDiv.style.display = 'block';
                errorsDiv.innerHTML = errors.map(err => `<p>${err}</p>`).join('');
            }
        }

        // Test credential loading
        setTimeout(() => {
            const clientId = window.GOOGLE_CLIENT_ID || 'NOT_LOADED';
            const apiKey = window.GOOGLE_API_KEY || 'NOT_LOADED';
            
            document.getElementById('clientId').textContent = clientId;
            document.getElementById('apiKey').textContent = apiKey ? 'Present' : 'Missing';
            
            // Test API loading
            let attempts = 0;
            const checkAPIs = setInterval(() => {
                attempts++;
                
                const gapiReady = typeof gapi !== 'undefined';
                const googleReady = typeof google !== 'undefined';
                const accountsReady = googleReady && google.accounts;
                
                document.getElementById('gapiStatus').textContent = gapiReady ? '‚úÖ Loaded' : '‚ùå Not loaded';
                document.getElementById('googleStatus').textContent = googleReady ? '‚úÖ Loaded' : '‚ùå Not loaded';
                document.getElementById('accountsStatus').textContent = accountsReady ? '‚úÖ Loaded' : '‚ùå Not loaded';
                
                if (gapiReady && googleReady && accountsReady) {
                    clearInterval(checkAPIs);
                    console.log('‚úÖ All APIs loaded successfully');
                } else if (attempts > 60) {
                    clearInterval(checkAPIs);
                    console.error('‚ùå API loading timeout');
                }
            }, 500);
        }, 1000);
    </script>
</body>
</html>